<!DOCTYPE html>
<html  class="no-js"
       xmlns:th="http://www.thymeleaf.org"
       xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
       xmlns="http://www.w3.org/1999/html"
       xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
       layout:decorate="~{layouts/layout.html}">
<head>
    <title>맛동산 | 프로필 수정</title>
</head>
<body>
<div layout:fragment="content">
    <!--=====================================-->
    <!--=       Container  Area Start       =-->
    <!--=====================================-->
    <div class="container light-style flex-grow-1">

        <h4 class="font-weight-bold py-3 mb-4">
            Account settings
        </h4>

        <div class="card overflow-hidden">
            <div class="row no-gutters row-bordered row-border-light">
                <div class="col-md-3 pt-0">
                    <div class="list-group list-group-flush account-settings-links">
                        <a class="list-group-item list-group-item-action active" data-toggle="list" href="#account-general">General</a>
                        <a class="list-group-item list-group-item-action" data-toggle="list" href="#account-change-password">Password</a>
                        <a class="list-group-item list-group-item-action" data-toggle="list" href="#account-connections">Withdraw</a>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="tab-content">
                        <div class="tab-pane fade active show" id="account-general">
                            <div class="d-flex justify-content-start">

                            </div>
                            <div class="card-body media align-items-center justify-content-start bd-highlight">
                                <div class="ml-4">
                                    <img src="/media/banner/user_1.jpg" alt="" class="rounded-circle">
                                </div>
                                <div class="form-group ml-4">
                                    <label class="form-label">닉네임</label>
                                    <input type="text" class="form-control mb-1" th:value="${member.getNickname()}" data-toggle="modal" data-target="#nicknameChange" data-whatever="@mdo" autocomplete="off">
                                    <div class="modal fade" id="nicknameChange" tabindex="-1" role="dialog" aria-labelledby="nicknameChangeLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="nicknameChangeLabel">닉네임 변경</h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    <form id="changeNickname">
                                                        <div class="form-group">
                                                            <label for="nickname" class="col-form-label">닉네임</label>
                                                            <input type="text" class="form-control" name="nickname" id="nickname" th:value="${member.getNickname()}">
                                                            <button type="button" class="btn btn-secondary" id="duplicateId">중복 확인</button>
                                                            <span id="dupplicateMsg"></span>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                                                            <button type="button" id="nicknameSubmitBtn" class="btn btn-primary">변경하기</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="account-change-password">
                            <div class="card-body pb-2">

                                <div class="form-group">
                                    <label class="form-label">현재 비밀번호</label>
                                    <input type="password" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">새로운 비밀번호</label>
                                    <input type="password" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">비밀번호 확인</label>
                                    <input type="password" class="form-control">
                                </div>

                                <div class="text-right mt-3">
                                    <button type="button" class="btn btn-primary">변경</button>&nbsp;
                                </div>

                            </div>
                        </div>
                        <div class="tab-pane fade" id="account-connections">
                            <button class="btn btn-danger">회원 탈퇴</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $("#duplicateId").click(function(){
        console.log("버튼 클릭")
        $.ajax({
            type: "get",
            url: "/profile/nicknameCheck",
            data : $('#changeNickname').serialize(),
            async: true ,
            success : function(flag){
                console.log(flag);
                if(flag) {
                    $("#dupplicateMsg").text("이미 사용중인 ID 입니다.")
                        .addClass("text-danger")
                        .removeClass("text-primary");
                    $("#nicknameSubmitBtn").attr("type", "button");
                } else {
                    idChk = true;
                    console.log("idChk : " + idChk);
                    $("#dupplicateMsg").text("사용 가능한 ID 입니다.")
                        .addClass("text-primary")
                        .removeClass("text-danger");
                    $("#nickname").attr("readonly", "true")
                        .addClass("bg-light");
                }
            },
        });
    });
</script>
</body>

</html>